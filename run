#!/usr/bin/env bash
set -euo pipefail

echo "=== AIRDROP NVIM ==="

# 1. Update system and upgrade packages
sudo apt-get update && sudo apt-get upgrade -y

# 2. Install build/runtime dependencies
#    - git: clone repos
#    - ninja-build, cmake, gettext, build-essential, pkg-config, libtool: Neovim source build
#    - curl, unzip: download & extract
#    - ripgrep, fd-find: fuzzy/file searching
#    - xclip: system clipboard support in terminal Neovim
sudo apt-get install -y \
    git ninja-build cmake gettext \
    build-essential pkg-config libtool \
    curl unzip ripgrep fd-find xclip

# 3. Install Compiledb for compile_commands.json generation
pip3 install --user compiledb

# 4. Install a C/C++ LSP server (clangd) â€” adjust if you prefer ccls or another
sudo apt-get install -y clangd

# 5. Build and install Neovim from source (portable across architectures)
echo "=== BUILDING NEOVIM ==="
cd "$HOME"
if [ -d neovim ]; then
  rm -rf neovim
fi
git clone https://github.com/neovim/neovim.git
cd neovim
make CMAKE_BUILD_TYPE=Release
sudo make install

# 6. Deploy your custom Neovim config from your dotfiles repo
echo "=== INSTALLING NVIM CONFIG ==="
cd "$HOME"
if [ -d dotfiles ]; then
  rm -rf dotfiles
fi
git clone https://github.com/starboi-63/dotfiles.git
mkdir -p ~/.config/nvim
cp -r ~/dotfiles/home/.config/nvim/* ~/.config/nvim/

echo "=== AIRDROP NVIM COMPLETE ==="

